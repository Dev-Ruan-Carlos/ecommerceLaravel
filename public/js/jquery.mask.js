!function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory(window.jQuery||window.Zepto)}((function($){"use strict";var Mask=function(el,mask,options){var jMask=this,old_value,regexMask;el=$(el),mask="function"==typeof mask?mask(el.val(),void 0,el,options):mask;var p={getCaret:function(){try{var sel,pos=0,ctrl=el.get(0),dSel=document.selection,cSelStart=ctrl.selectionStart;return dSel&&!~navigator.appVersion.indexOf("MSIE 10")?((sel=dSel.createRange()).moveStart("character",el.is("input")?-el.val().length:-el.text().length),pos=sel.text.length):(cSelStart||"0"===cSelStart)&&(pos=cSelStart),pos}catch(e){}},setCaret:function(pos){try{if(el.is(":focus")){var range,ctrl=el.get(0);ctrl.setSelectionRange?ctrl.setSelectionRange(pos,pos):ctrl.createTextRange&&((range=ctrl.createTextRange()).collapse(!0),range.moveEnd("character",pos),range.moveStart("character",pos),range.select())}}catch(e){}},events:function(){el.on("keydown.mask",(function(){old_value=p.val()})).on("keyup.mask",p.behaviour).on("paste.mask drop.mask",(function(){setTimeout((function(){el.keydown().keyup()}),100)})).on("change.mask",(function(){el.data("changed",!0)})).on("blur.mask",(function(){old_value===el.val()||el.data("changed")||el.trigger("change"),el.data("changed",!1)})).on("focusout.mask",(function(){options.clearIfNotMatch&&!regexMask.test(p.val())&&p.val("")}))},getRegexMask:function(){for(var maskChunks=[],translation,pattern,optional,recursive,oRecursive,r,i=0;i<mask.length;i++)(translation=jMask.translation[mask[i]])?(pattern=translation.pattern.toString().replace(/.{1}$|^.{1}/g,""),optional=translation.optional,(recursive=translation.recursive)?(maskChunks.push(mask[i]),oRecursive={digit:mask[i],pattern:pattern}):maskChunks.push(optional||recursive?pattern+"?":pattern)):maskChunks.push(mask[i].replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"));return r=maskChunks.join(""),oRecursive&&(r=r.replace(new RegExp("("+oRecursive.digit+"(.*"+oRecursive.digit+")?)"),"($1)?").replace(new RegExp(oRecursive.digit,"g"),oRecursive.pattern)),new RegExp(r)},destroyEvents:function(){el.off(["keydown","keyup","paste","drop","change","blur","focusout","DOMNodeInserted",""].join(".mask ")).removeData("changeCalled")},val:function(v){var isInput=el.is("input");return arguments.length>0?isInput?el.val(v):el.text(v):isInput?el.val():el.text()},getMCharsBeforeCount:function(index,onCleanVal){for(var count=0,i=0,maskL=mask.length;i<maskL&&i<index;i++)jMask.translation[mask.charAt(i)]||(index=onCleanVal?index+1:index,count++);return count},caretPos:function(originalCaretPos,oldLength,newLength,maskDif){var translation;return jMask.translation[mask.charAt(Math.min(originalCaretPos-1,mask.length-1))]?Math.min(originalCaretPos+newLength-oldLength-maskDif,newLength):p.caretPos(originalCaretPos+1,oldLength,newLength,maskDif)},behaviour:function(e){var keyCode=(e=e||window.event).keyCode||e.which;if(-1===$.inArray(keyCode,jMask.byPassKeys)){var caretPos=p.getCaret(),currVal=p.val(),currValL=currVal.length,changeCaret=caretPos<currValL,newVal=p.getMasked(),newValL=newVal.length,maskDif=p.getMCharsBeforeCount(newValL-1)-p.getMCharsBeforeCount(currValL-1);return newVal!==currVal&&p.val(newVal),!changeCaret||65===keyCode&&e.ctrlKey||(8!==keyCode&&46!==keyCode&&(caretPos=p.caretPos(caretPos,currValL,newValL,maskDif)),p.setCaret(caretPos)),p.callbacks(e)}},getMasked:function(skipMaskChars){var buf=[],value=p.val(),m=0,maskLen=mask.length,v=0,valLen=value.length,offset=1,addMethod="push",resetPos=-1,lastMaskChar,check;for(options.reverse?(addMethod="unshift",offset=-1,lastMaskChar=0,m=maskLen-1,v=valLen-1,check=function(){return m>-1&&v>-1}):(lastMaskChar=maskLen-1,check=function(){return m<maskLen&&v<valLen});check();){var maskDigit=mask.charAt(m),valDigit=value.charAt(v),translation=jMask.translation[maskDigit];translation?(valDigit.match(translation.pattern)?(buf[addMethod](valDigit),translation.recursive&&(-1===resetPos?resetPos=m:m===lastMaskChar&&(m=resetPos-offset),lastMaskChar===resetPos&&(m-=offset)),m+=offset):translation.optional&&(m+=offset,v-=offset),v+=offset):(skipMaskChars||buf[addMethod](maskDigit),valDigit===maskDigit&&(v+=offset),m+=offset)}var lastMaskCharDigit=mask.charAt(lastMaskChar);return maskLen!==valLen+1||jMask.translation[lastMaskCharDigit]||buf.push(lastMaskCharDigit),buf.join("")},callbacks:function(e){var val=p.val(),changed=val!==old_value;!0===changed&&"function"==typeof options.onChange&&options.onChange(val,e,el,options),!0===changed&&"function"==typeof options.onKeyPress&&options.onKeyPress(val,e,el,options),"function"==typeof options.onComplete&&val.length===mask.length&&options.onComplete(val,e,el,options)}};jMask.mask=mask,jMask.options=options,jMask.remove=function(){var caret;return p.destroyEvents(),p.val(jMask.getCleanVal()).removeAttr("maxlength"),caret=p.getCaret(),p.setCaret(caret-p.getMCharsBeforeCount(caret)),el},jMask.getCleanVal=function(){return p.getMasked(!0)},jMask.init=function(){options=options||{},jMask.byPassKeys=[9,16,17,18,36,37,38,39,40,91],jMask.translation={0:{pattern:/\d/},9:{pattern:/\d/,optional:!0},"#":{pattern:/\d/,recursive:!0},A:{pattern:/[a-zA-Z0-9]/},S:{pattern:/[a-zA-Z]/}},jMask.translation=$.extend({},jMask.translation,options.translation),jMask=$.extend(!0,{},jMask,options),regexMask=p.getRegexMask(),!1!==options.maxlength&&el.attr("maxlength",mask.length),options.placeholder&&el.attr("placeholder",options.placeholder),el.attr("autocomplete","off"),p.destroyEvents(),p.events();var caret=p.getCaret();p.val(p.getMasked()),p.setCaret(caret+p.getMCharsBeforeCount(caret,!0))}()},watchers={},live="DOMNodeInserted.mask",HTMLAttributes=function(){var input=$(this),options={},prefix="data-mask-";input.attr(prefix+"reverse")&&(options.reverse=!0),"false"===input.attr(prefix+"maxlength")&&(options.maxlength=!1),input.attr(prefix+"clearifnotmatch")&&(options.clearIfNotMatch=!0),input.mask(input.attr("data-mask"),options)};$.fn.mask=function(mask,options){var selector=this.selector,maskFunction=function(){var maskObject=$(this).data("mask"),stringify=JSON.stringify;if("object"!=typeof maskObject||stringify(maskObject.options)!==stringify(options)||maskObject.mask!==mask)return $(this).data("mask",new Mask(this,mask,options))};this.each(maskFunction),selector&&!watchers[selector]&&(watchers[selector]=!0,setTimeout((function(){$(document).on(live,selector,maskFunction)}),500))},$.fn.unmask=function(){try{return this.each((function(){$(this).data("mask").remove().removeData("mask")}))}catch(e){}},$.fn.cleanVal=function(){return this.data("mask").getCleanVal()},$("*[data-mask]").each(HTMLAttributes),$(document).on(live,"*[data-mask]",HTMLAttributes)}));